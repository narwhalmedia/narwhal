# buf.gen.yaml - Buf code generation configuration
# https://buf.build/docs/configuration/v2/buf-gen-yaml
version: v2

# Managed mode for consistent code generation
managed:
  enabled: true
  override:
    # Go package prefix override
    - file_option: go_package_prefix
      value: github.com/narwhalmedia/narwhal

# Plugins for code generation
plugins:
  # Protocol Buffers Go plugin
  - remote: buf.build/protocolbuffers/go:v1.32.0
    out: .
    opt:
      - paths=source_relative

  # gRPC Go plugin
  - remote: buf.build/grpc/go:v1.3.0
    out: .
    opt:
      - paths=source_relative
      - require_unimplemented_servers=false

  # Optional: gRPC-Gateway for REST API
  - remote: buf.build/grpc-ecosystem/gateway:v2.27.1
    out: gen
    opt:
      - paths=source_relative

  # Optional: OpenAPI v2 documentation
  - remote: buf.build/grpc-ecosystem/openapiv2:v2.27.1
    out: api/openapi
    opt:
      - simple_operation_ids=true
      - json_names_for_fields=true

# Input configuration
inputs:
  - directory: api/proto
